<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendex | Premium Tech Store</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'var(--background)',
                        foreground: 'var(--foreground)',
                        card: 'var(--card)',
                        'card-foreground': 'var(--card-foreground)',
                        primary: 'var(--primary)',
                        'primary-foreground': 'var(--primary-foreground)',
                        'primary-container': 'var(--primary-container)',
                        'on-primary-container': 'var(--on-primary-container)',
                        'secondary-container': 'var(--secondary-container)',
                        tertiary: 'var(--tertiary)',
                        'tertiary-foreground': 'var(--tertiary-foreground)',
                        'tertiary-container': 'var(--tertiary-container)',
                        'on-tertiary-container': 'var(--on-tertiary-container)',
                        destructive: 'var(--destructive)',
                        'muted-foreground': 'var(--muted-foreground)',
                        border: 'var(--border)'
                    },
                    borderRadius: {
                        xl: '0.75rem',
                        '2xl': '1.5rem'
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --background: #FEF7FF;
            --foreground: #1D1B20;
            --card: #FFFFFF;
            --card-foreground: #1D1B20;
            --primary: #6750A4;
            --primary-foreground: #FFFFFF;
            --primary-container: #EADDFF;
            --on-primary-container: #21005D;
            --secondary-container: #E8DEF8;
            --tertiary: #7D5260;
            --tertiary-foreground: #FFFFFF;
            --tertiary-container: #FFD8E4;
            --on-tertiary-container: #31111D;
            --destructive: #BA1A1A;
            --muted-foreground: #49454F;
            --border: #CAC4D0;
        }

        body.dark {
            --background: #1D1B20;
            --foreground: #E6E1E5;
            --card: #1D1B20;
            --card-foreground: #E6E1E5;
            --primary: #D0BCFF;
            --primary-foreground: #371E73;
            --primary-container: #4F378B;
            --on-primary-container: #EADDFF;
            --secondary-container: #4A4458;
            --tertiary: #EFB8C8;
            --tertiary-foreground: #492532;
            --tertiary-container: #633B48;
            --on-tertiary-container: #ffd8e4;
            --destructive: #FFB4AB;
            --muted-foreground: #CAC4D0;
            --border: #49454F;
        }

        body {
            background-color: var(--background);
            color: var(--foreground);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="dark min-h-screen flex flex-col">
    <% 
        // Get all categories from the products list
        const allCategories = products.map(p => p.google_category.split('>').pop().trim());
        
        // Filter for unique ones only (so we don't have duplicates)
        const uniqueCategories = [...new Set(allCategories)].sort(); 
    %>

    <header class="sticky top-0 z-40 bg-card shadow-sm border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <h1 class="text-xl font-bold text-primary">Vendex</h1>
                </div>

                <div class="hidden md:flex flex-1 max-w-2xl mx-8">
                    <div class="relative w-full">
                        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-muted-foreground" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        <input type="search" placeholder="Search products..." class="w-full pl-12 pr-4 py-2.5 bg-secondary-container rounded-full outline-none focus:ring-2 focus:ring-primary transition-all text-foreground placeholder-muted-foreground" />
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="toggleTheme()" class="p-2 hover:bg-secondary-container rounded-full transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                    </button>
                    <button onclick="toggleCart()" class="relative p-2 hover:bg-secondary-container rounded-full transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                        <span id="cart-badge" class="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center bg-destructive text-white rounded-full text-xs font-bold hidden">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <div class="bg-primary-container rounded-2xl overflow-hidden mb-8">
            <div class="max-w-7xl mx-auto px-6 py-12 sm:py-16 lg:py-20">
                <div class="grid lg:grid-cols-2 gap-8 items-center">
                    <div>
                        <div class="inline-block bg-tertiary-container text-on-tertiary-container px-4 py-2 rounded-full mb-4 text-sm font-medium">New Arrivals</div>
                        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-on-primary-container mb-4 leading-tight">Summer Collection 2024</h1>
                        <p class="text-lg text-on-primary-container/80 mb-8 max-w-xl">Discover the latest tech gadgets and accessories. Get 17% off on all items.</p>
                        <button class="bg-primary text-primary-foreground px-8 py-3.5 rounded-full hover:shadow-lg transition-all inline-flex items-center gap-2 font-medium">
                            Shop Now <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-card rounded-xl p-6 text-center shadow-sm"><div class="text-3xl font-bold text-primary mb-2">500+</div><div class="text-muted-foreground">Products</div></div>
                        <div class="bg-card rounded-xl p-6 text-center shadow-sm"><div class="text-3xl font-bold text-primary mb-2">5K+</div><div class="text-muted-foreground">Customers</div></div>
                        <div class="bg-card rounded-xl p-6 text-center shadow-sm"><div class="text-3xl font-bold text-primary mb-2">4.8★</div><div class="text-muted-foreground">Rating</div></div>
                        <div class="bg-card rounded-xl p-6 text-center shadow-sm"><div class="text-3xl font-bold text-primary mb-2">Fast</div><div class="text-muted-foreground">Delivery</div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-[280px_1fr] gap-8">
            
            <aside class="hidden lg:block h-fit sticky top-24">
                <div class="bg-card rounded-xl p-4 shadow-sm border border-border">
                    <h3 class="mb-4 font-semibold text-lg">Categories</h3>
                    <div class="space-y-2" id="category-list">
                        <button onclick="filterCategory('all')" class="w-full text-left px-4 py-2.5 rounded-full transition-all bg-primary-container text-on-primary-container font-medium category-btn" data-category="all">
                            All Products
                        </button>

                        <% uniqueCategories.forEach(function(category) { %>
                            <button onclick="filterCategory('<%= category %>')" class="w-full text-left px-4 py-2.5 rounded-full transition-all hover:bg-secondary-container text-muted-foreground hover:text-foreground category-btn" data-category="<%= category %>">
                                <%= category %>
                            </button>
                        <% }); %>
                    </div>
                </div>
            </aside>

            <div>
                <div class="mb-6 flex items-center justify-between">
                    <h2 class="text-2xl font-bold" id="current-category-title">All Products</h2>
                    <div class="text-sm text-muted-foreground"><span id="product-count"><%= products.length %></span> products</div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="product-grid">
                    <% products.forEach(function(product) { 
                        // Simulate discount logic
                        const originalPrice = (product.price * 1.2).toFixed(2);
                        const discount = Math.round(((originalPrice - product.price) / originalPrice) * 100);
                        // Infer category from google_category for filtering
                        const simpleCategory = product.google_category.split('>').pop().trim();
                    %>
                        <div class="bg-card rounded-xl overflow-hidden transition-all hover:shadow-lg group border border-border product-card" data-category="<%= simpleCategory %>">
    
                            <div class="relative aspect-square bg-secondary-container overflow-hidden">
                                
                                <a href="/product/<%= product.id %>" class="block w-full h-full">
                                    <img 
                                        src="<%= product.image %>" 
                                        alt="<%= product.title %>"
                                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                    />
                                </a>
                                
                                <div class="absolute top-3 left-3 bg-tertiary text-tertiary-foreground px-3 py-1 rounded-full text-xs font-bold shadow-sm pointer-events-none">
                                    -<%= discount %>%
                                </div>
                                
                                <button onclick="toggleHeart(this, event)" class="absolute top-3 right-3 z-10 h-10 w-10 flex items-center justify-center bg-card/80 backdrop-blur-md rounded-full shadow-md hover:bg-white hover:text-destructive transition-colors group/heart">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-all">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="p-4 flex flex-col flex-grow">
                                <div class="text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wider">
                                    <%= product.brand %>
                                </div>
                                
                                <a href="/product/<%= product.id %>" class="block mb-2">
                                    <h3 class="font-semibold text-lg leading-tight line-clamp-2 min-h-[3rem] hover:text-primary transition-colors">
                                        <%= product.title %>
                                    </h3>
                                </a>
                                
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center gap-1 text-yellow-500">
                                        <span class="text-sm">⭐</span>
                                        <span class="text-sm font-medium"><%= product.rating || '4.5' %></span>
                                    </div>
                                    <span class="text-sm text-muted-foreground">(<%= product.reviews || '10' %>)</span>
                                </div>

                                <div class="flex items-baseline gap-2 mb-4 mt-auto">
                                    <span class="text-xl font-bold text-primary">$<%= product.price.toFixed(2) %></span>
                                    <span class="text-sm text-muted-foreground line-through decoration-destructive/40">
                                        $<%= originalPrice %>
                                    </span>
                                </div>

                                <button onclick="addToCart(<%= JSON.stringify(product) %>)" class="w-full bg-primary text-primary-foreground py-3 px-4 rounded-full hover:shadow-lg hover:opacity-90 active:scale-95 transition-all flex items-center justify-center gap-2 font-medium">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </div>
    </main>

    <div id="cart-backdrop" onclick="toggleCart()" class="fixed inset-0 bg-black/50 z-40 hidden transition-opacity opacity-0"></div>

    <div id="cart-drawer" class="fixed right-0 top-0 h-full w-full max-w-md bg-card z-50 shadow-2xl flex flex-col transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex items-center justify-between p-4 border-b border-border">
            <h2 class="text-lg font-bold">Shopping Cart</h2>
            <button onclick="toggleCart()" class="p-2 hover:bg-secondary-container rounded-full transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div id="cart-items-container" class="flex-1 overflow-y-auto p-4 space-y-4">
            <div class="flex flex-col items-center justify-center h-full text-center text-muted-foreground">
                <p>Your cart is empty</p>
            </div>
        </div>
        <div id="cart-footer" class="border-t border-border p-4 space-y-4 hidden">
            <div class="space-y-2">
                <div class="flex justify-between text-sm"><span class="text-muted-foreground">Subtotal</span><span id="cart-subtotal">$0.00</span></div>
                <div class="flex justify-between text-sm"><span class="text-muted-foreground">Tax (10%)</span><span id="cart-tax">$0.00</span></div>
                <div class="flex justify-between pt-2 border-t border-border font-bold text-lg"><span>Total</span><span id="cart-total" class="text-primary">$0.00</span></div>
            </div>
            <button class="w-full bg-primary text-primary-foreground py-3.5 px-4 rounded-full hover:shadow-lg transition-all font-bold">Proceed to Checkout</button>
        </div>
    </div>

<script>
        // --- THEME LOGIC ---
        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }
        if (localStorage.getItem('theme') === 'light') document.body.classList.remove('dark');

        // --- CART LOGIC WITH PERSISTENCE ---
        let cart = []; 

        // 1. LOAD CART ON STARTUP
        function loadCart() {
            const savedCart = localStorage.getItem('vendex_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartUI();
            }
        }

        // 2. SAVE CART TO LOCAL STORAGE
        function saveCart() {
            localStorage.setItem('vendex_cart', JSON.stringify(cart));
            updateCartUI(); // Update UI whenever we save
        }

        function toggleCart() {
            const drawer = document.getElementById('cart-drawer');
            const backdrop = document.getElementById('cart-backdrop');
            const isOpen = !drawer.classList.contains('translate-x-full');

            if (isOpen) {
                drawer.classList.add('translate-x-full');
                backdrop.classList.add('hidden');
                setTimeout(() => backdrop.classList.remove('opacity-100'), 0);
            } else {
                drawer.classList.remove('translate-x-full');
                backdrop.classList.remove('hidden');
                setTimeout(() => backdrop.classList.add('opacity-100'), 10);
            }
        }

        function addToCart(product) {
            const existing = cart.find(item => item.id === product.id);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            saveCart(); // Save immediately
            toggleCart(); // Open drawer
        }

        function updateQuantity(id, change) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) cart = cart.filter(i => i.id !== id);
                saveCart(); // Save changes
            }
        }

        function removeItem(id) {
            cart = cart.filter(i => i.id !== id);
            saveCart(); // Save changes
        }

        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            const footer = document.getElementById('cart-footer');
            const badge = document.getElementById('cart-badge');
            
            const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
            badge.innerText = totalItems;
            badge.classList.toggle('hidden', totalItems === 0);

            if (cart.length === 0) {
                container.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center text-muted-foreground"><p>Your cart is empty</p></div>`;
                footer.classList.add('hidden');
                return;
            }

            container.innerHTML = cart.map(item => `
                <div class="flex gap-4 bg-secondary-container/50 rounded-xl p-3">
                    <img src="${item.image}" class="w-20 h-20 object-cover rounded-lg flex-shrink-0" />
                    <div class="flex-1 min-w-0">
                        <h4 class="font-semibold line-clamp-1">${item.title}</h4>
                        <p class="text-primary mb-2">$${item.price}</p>
                        <div class="flex items-center gap-2">
                            <button onclick="updateQuantity(${item.id}, -1)" class="p-1 hover:bg-card rounded-full"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
                            <span class="w-6 text-center text-sm">${item.quantity}</span>
                            <button onclick="updateQuantity(${item.id}, 1)" class="p-1 hover:bg-card rounded-full"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
                        </div>
                    </div>
                    <button onclick="removeItem(${item.id})" class="text-destructive p-2"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
                </div>
            `).join('');

            const subtotal = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            const tax = subtotal * 0.1;
            
            document.getElementById('cart-subtotal').innerText = `$${subtotal.toFixed(2)}`;
            document.getElementById('cart-tax').innerText = `$${tax.toFixed(2)}`;
            document.getElementById('cart-total').innerText = `$${(subtotal + tax).toFixed(2)}`;
            footer.classList.remove('hidden');
        }

        // --- HEART BUTTON LOGIC ---
        function toggleHeart(btn, e) {
            e.preventDefault(); 
            const svg = btn.querySelector('svg');
            
            // Toggle the 'filled' state
            if (btn.classList.contains('text-destructive')) {
                // Un-like
                btn.classList.remove('text-destructive'); 
                svg.setAttribute('fill', 'none');
            } else {
                // Like
                btn.classList.add('text-destructive'); 
                svg.setAttribute('fill', 'currentColor');
            }
        }

        // --- CATEGORY FILTER LOGIC ---
        function filterCategory(category) {
            const cards = document.querySelectorAll('.product-card');
            const buttons = document.querySelectorAll('.category-btn');
            
            // Update Active Button State
            buttons.forEach(btn => {
                if(btn.dataset.category === category) {
                    btn.classList.add('bg-primary-container', 'text-on-primary-container');
                    btn.classList.remove('text-muted-foreground');
                } else {
                    btn.classList.remove('bg-primary-container', 'text-on-primary-container');
                    btn.classList.add('text-muted-foreground');
                }
            });

            // Filter Grid
            let visibleCount = 0;
            cards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'flex'; // Restore flex layout
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Update Title & Count
            document.getElementById('current-category-title').innerText = category === 'all' ? 'All Products' : category;
            document.getElementById('product-count').innerText = visibleCount;
        }

        // INITIALIZE
        loadCart();
    </script>
</body>
</html>